{% set active_page = "Schedule" %}
{% set page_title = "Schedule" %}
{% extends "base.html" %}
{% block head %}
    {{ super() }}
    {% include 'cal_head.html' %}
{% endblock %}

{% block tabs %}
    {{ components.tabs([
    ("calendar", "Calendar", "cal-nav active"),
    ("Saturday", "Saturday", "cal-nav"),
    ("Sunday", "Sunday", "cal-nav"),
    ("Monday", "Monday", "cal-nav"),
    ("Tuesday", "Tuesday", "cal-nav"),
    ("Wednesday", "Wednesday", "cal-nav"),
    ("Thursday", "Thursday", "cal-nav"),
    ("Friday", "Friday", "cal-nav")
  ]) }}
{% endblock %}

{% block content %}

    <div class="form-group col mt-5">
        <label for="tzOptions">Timezone:</label>
        <select id="tzOptions" class="selectpicker" data-live-search="true">
        </select>
    </div>

    <div class="tab-content py-3 px-3 px-sm-0" id="nav-tabContent">
        <!-- Calender tab -->
        <div
                class="tab-pane active"
                id="tab-calendar"
                role="tabpanel"
                aria-labelledby="nav-profile-tab"
        >

            <!-- full cal for browser-->
            <div id="calendar" class="d-none d-sm-block"></div>

            <!-- small cal for smart phones -->
            <!-- <div id="calendar_small" class="d-sm-none"></div> -->

            {#    <script type="text/javascript">#}
            {#      make_cal("serve_main_calendar.json");#}
            {#    </script>#}
        </div>

        <!-- Day Tab -->

        {% for day in days %}
            <div
                    class="tab-pane fade"
                    id="tab-{{ day }}"
                    role="tabpanel"
                    aria-labelledby="nav-profile-tab"
            >
                <div id="cal__{{ loop.index }}" class="d-none d-sm-block"></div>

                <div id="day">
                    {{ components.section("Sessions") }}
                    <div class="sessions">
                        {{ components.sessiongroup(days[day].timeslots, config["calendar"]["colors"] ) }}
                    </div>
                </div>
            </div>
        {% endfor %}

        <script type="text/javascript">
          window.onload = () => {
            const tabPanes = $(".tab-pane");
            // Render cals:
            make_cal("serve_main_calendar.json")
              .then(({render}) => {
                // re-render cal
                tabPanes.css('display', 'block')
                render();
                tabPanes.css('display', '')

                // re-render cal on resize
                $(window).on('resize', _.debounce(() => {
                  tabPanes.css('display', 'block');
                  render();
                  tabPanes.css('display', '');
                }, 500));
              })

            lazyLoader();
          }
        </script>
    </div>
{% endblock %}
